version: '3.8'

services:
  github-runner:
    build:
      context: .
      args:
        RUNNER_VERSION: ${RUNNER_VERSION:-2.328.0}
        UBUNTU_VERSION: ${UBUNTU_VERSION:-24.04}
    environment:
      - REPO_URL=${REPO_URL}
      - REGISTRATION_TOKEN=${REGISTRATION_TOKEN}
      - RUNNER_NAME=${RUNNER_NAME:-docker-runner}
      - RUNNER_LABELS=${RUNNER_LABELS:-docker,linux}
      - EPHEMERAL=${EPHEMERAL:-false}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - runner_work:/runner/_work
      - runner_toolcache:/opt/hostedtoolcache
    restart: unless-stopped
    privileged: true
    deploy:
      replicas: 3

volumes:
  runner_work:
  runner_toolcache: